{% extends "base.html" %}

{% block title %}Browse Jobs - HireWave{% endblock %}

{% block extra_css %}
<style>
    .jobs-section {
        position: relative;
        min-height: 60vh;
    }

    .jobs-header-banner {
        background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue));
        color: var(--white);
        padding: 3rem 0;
        margin-bottom: 2rem;
        border-radius: 20px;
        position: relative;
        overflow: hidden;
        box-shadow: var(--shadow-xl);
    }

    .jobs-header-banner::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
        animation: rotate 20s linear infinite;
    }

    .jobs-header-content {
        position: relative;
        z-index: 1;
        text-align: center;
    }

    .jobs-header-content h1 {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
        font-weight: 800;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        color: var(--white);
    }

    .jobs-count {
        font-size: 1.1rem;
        opacity: 0.95;
        font-weight: 500;
        text-shadow: 0 1px 5px rgba(0, 0, 0, 0.2);
    }

    .jobs-filters {
        background: var(--white);
        padding: 1.5rem;
        border-radius: 16px;
        box-shadow: var(--shadow);
        margin-bottom: 2rem;
        border: 2px solid #e2e8f0;
    }

    .job-card {
        animation: fadeIn 0.5s ease;
    }

    .job-card:hover .job-header h3 {
        color: var(--primary-blue);
    }

    /* Jobs Grid Container */
    .jobs-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 2rem;
        width: 100%;
    }

    /* When empty state is the only child, center it */
    .jobs-grid:has(.empty-state) {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    /* Empty State Styling */
    .empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 4rem 2rem;
        min-height: 300px;
        background: linear-gradient(135deg, rgba(37, 99, 235, 0.05), rgba(255, 255, 255, 0.9));
        border-radius: 20px;
        border: 2px dashed var(--primary-blue);
        margin: 2rem 0;
        width: 100%;
        max-width: 600px;
    }

    .empty-state::before {
        content: 'ðŸ“­';
        display: block;
        font-size: 4rem;
        margin-bottom: 1rem;
        animation: bounce 2s infinite;
    }

    .empty-state-text {
        color: var(--dark-gray);
        font-size: 1.2rem;
        font-weight: 500;
        line-height: 1.6;
    }

    @keyframes bounce {
        0%, 100% {
            transform: translateY(0);
        }
        50% {
            transform: translateY(-10px);
        }
    }
</style>
{% endblock %}

{% block content %}
<section class="jobs-section animated-bg">
    <div class="mesh-gradient"></div>
    <div class="container" style="position: relative; z-index: 1;">
        <div class="jobs-header-banner">
            <div class="jobs-header-content">
                <h1>Discover Your Dream Job</h1>
                <p class="jobs-count">Explore <span id="jobsCount">0</span> exciting opportunities</p>
            </div>
        </div>

        <div class="jobs-filters shimmer">
            <select id="jobTypeFilter" onchange="filterJobs()">
                <option value="">All Types</option>
                <option value="technical">Technical</option>
                <option value="non_technical">Non-Technical</option>
            </select>

            <input type="text" id="searchInput" placeholder="Search jobs by title, company, or skills..."
                onkeyup="filterJobs()">
        </div>

        <div id="jobsList" class="jobs-grid">
            <div class="loading">Loading amazing opportunities...</div>
        </div>
    </div>
</section>

<script>
    let allJobs = [];

    async function loadJobs() {
        const token = localStorage.getItem('token');

        const headers = {};
        if (token) {
            headers['Authorization'] = `Bearer ${token}`;
        }

        try {
            const response = await fetch('/api/jobs?status=active', {
                headers: headers
            });

            if (response.ok) {
                allJobs = await response.json();
                document.getElementById('jobsCount').textContent = allJobs.length;
                displayJobs(allJobs);
            } else if (response.status === 401) {
                // Not authenticated, redirect to login
                window.location.href = '/login?redirect=/jobs';
            } else {
                document.getElementById('jobsList').innerHTML = '<div class="empty-state">Failed to load jobs</div>';
            }
        } catch (error) {
            console.error('Error loading jobs:', error);
            document.getElementById('jobsList').innerHTML = '<div class="empty-state">Error loading jobs</div>';
        }
    }

    function displayJobs(jobs) {
        const container = document.getElementById('jobsList');

        if (jobs.length === 0) {
            container.style.display = 'flex';
            container.style.justifyContent = 'center';
            container.style.alignItems = 'center';
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-text">No jobs available at the moment. Check back soon!</div>
                </div>
            `;
            return;
        }

        container.style.display = 'grid';
        container.style.justifyContent = '';
        container.style.alignItems = '';
        container.innerHTML = jobs.map((job, index) => `
        <div class="job-card magnetic">
            <div class="job-header">
                <h3>${job.title}</h3>
                <span class="job-type-badge">${job.job_type}</span>
            </div>
            <p class="job-company"><i data-lucide="building-2" class="icon icon-sm"></i> ${job.company_name}</p>
            <p class="job-location"><i data-lucide="map-pin" class="icon icon-sm"></i> ${job.location}</p>
            <div class="job-skills">
                ${job.required_skills.slice(0, 3).map(skill => `<span class="skill-tag">${skill}</span>`).join('')}
                ${job.required_skills.length > 3 ? `<span class="skill-tag">+${job.required_skills.length - 3} more</span>` : ''}
            </div>
            <p class="job-description">${job.description.substring(0, 150)}...</p>
            <div class="job-footer">
                <span class="job-date"><i data-lucide="calendar" class="icon icon-sm"></i> Posted ${new Date(job.created_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</span>
                <a href="/jobs/${job._id || job.id}" class="btn btn-primary btn-small">
                    View Details <i data-lucide="arrow-right" class="icon icon-sm"></i>
                </a>
            </div>
        </div>
    `).join('');
    }

    function filterJobs() {
        const typeFilter = document.getElementById('jobTypeFilter').value;
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();

        let filtered = allJobs;

        if (typeFilter) {
            filtered = filtered.filter(job => job.job_type === typeFilter);
        }

        if (searchTerm) {
            filtered = filtered.filter(job =>
                job.title.toLowerCase().includes(searchTerm) ||
                job.description.toLowerCase().includes(searchTerm) ||
                job.company_name.toLowerCase().includes(searchTerm) ||
                job.required_skills.some(skill => skill.toLowerCase().includes(searchTerm))
            );
        }

        displayJobs(filtered);
    }

    loadJobs();
</script>
{% endblock %}